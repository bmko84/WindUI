local Players = game:GetService("Players")

local ReplicatedStorage = game:GetService("ReplicatedStorage")

local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer

local Camera = workspace.CurrentCamera
-- Orion UI
local OrionLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/shlexware/Orion/main/source"))()

local Window = OrionLib:MakeWindow({
	Name = "Silent Aim Menu",
	HidePremium = false,
	SaveConfig = true,
	ConfigFolder = "SilentAimUI"
})

local Tab = Window:MakeTab({
	Name = "Control",
	Icon = "rbxassetid://4483345998",
	PremiumOnly = false
})

Tab:AddToggle({
	Name = "Silent Aim",
	Default = SilentAimEnabled,
	Callback = function(Value)
		SilentAimEnabled = Value
	end    
})

Tab:AddSlider({
	Name = "FOV Size",
	Min = 50,
	Max = 300,
	Default = FOV,
	Increment = 1,
	ValueName = "px",
	Callback = function(Value)
		FOV = Value
	end    
})

OrionLib:Init()
local SilentAimEnabled = true

local FOV = 150

local CurrentTarget

local head, aimPos

local GunNames = {

    "P226","MP5","M24","Draco","Glock","Sawnoff","Uzi","G3","C9",

    "Hunting Rifle","Anaconda","AK47","Remington","Double Barrel"

}

local GunLookup = {}

for _, name in pairs(GunNames) do GunLookup[name] = true end

local fovCircle = Drawing.new("Circle")

fovCircle.Color = Color3.new(1,1,1)

fovCircle.Thickness = 2

fovCircle.NumSides = 100

fovCircle.Radius = FOV

fovCircle.Filled = false

fovCircle.Visible = true

fovCircle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)

local function GetClosestTarget()

    local closest

    local shortest = math.huge

    local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)

    for _, player in pairs(Players:GetPlayers()) do

        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then

            local screenPos, onScreen = Camera:WorldToViewportPoint(player.Character.Head.Position)

            if onScreen then

                local dist = (Vector2.new(screenPos.X, screenPos.Y) - center).Magnitude

                if dist < FOV and dist < shortest then

                    shortest = dist

                    closest = player

                end

            end

        end

    end

    return closest

end

local function IsHoldingAllowedGun(args)

    local ok, weapon = pcall(function() return args[3] end)

    if not ok then return false end

    if typeof(weapon) == "Instance" and GunLookup[weapon.Name] then

        return true

    end

    for _, child in pairs(LocalPlayer.Character:GetChildren()) do

        if (child:IsA("Tool") or child:IsA("Model")) and GunLookup[child.Name] then

            return true

        end

    end

    return false

end

local send = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Send")

local oldFire

oldFire = hookfunction(send.FireServer, function(self, ...)

    local args = {...}

    if SilentAimEnabled and IsHoldingAllowedGun(args) then

        CurrentTarget = GetClosestTarget()

        if CurrentTarget and CurrentTarget.Character and CurrentTarget.Character:FindFirstChild("Head") then

            head = CurrentTarget.Character.Head

            aimPos = head.Position

            args[4] = CFrame.new(1/0,1/0,1/0,0/0,0/0,0/0,0/0,0/0,0/0,0/0,0/0,0/0)

            args[5] = {[1]={[1]={["Instance"]=head,["Position"]=aimPos}}}

        end

    end

    return oldFire(self, unpack(args))

end)

local tracerLine = Drawing.new("Line")

tracerLine.Color = Color3.new(1,0,0)

tracerLine.Thickness = 2

tracerLine.Visible = false

RunService.RenderStepped:Connect(function()

    fovCircle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)

    fovCircle.Radius = FOV

    local target = GetClosestTarget()

    if target and target.Character and target.Character:FindFirstChild("Head") then

        local headPos = target.Character.Head.Position

        local screenPos, onScreen = Camera:WorldToViewportPoint(headPos)

        if onScreen then

            local ourHeadPos = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Head") and LocalPlayer.Character.Head.Position

            if ourHeadPos then

                local screenStart, startOnScreen = Camera:WorldToViewportPoint(ourHeadPos)

                if startOnScreen then

                    tracerLine.From = Vector2.new(screenStart.X, screenStart.Y)

                    tracerLine.To = Vector2.new(screenPos.X, screenPos.Y)

                    tracerLine.Visible = true

                else

                    tracerLine.Visible = false

                end

            else

                tracerLine.Visible = false

            end

        else

            tracerLine.Visible = false

        end

    else

        tracerLine.Visible = false

    end

end)
